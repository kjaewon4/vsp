<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{fragments/head :: commonHead}">
    <title>마이페이지</title>
</head>
<body>
    <header th:replace="fragments/header :: commonHeader"></header>

    <div class="container mt-5">
        <h2>마이페이지</h2>

        <!-- 사용자 정보 -->
        <div class="card mb-4">
            <div class="card-header">내 정보</div>
            <div class="card-body">
                <p><strong>아이디:</strong> <span th:text="${user.username}"></span></p>
                <p><strong>닉네임:</strong> <span th:text="${profile.nickname}"></span></p>
                <p><strong>이메일:</strong> <span th:text="${profile.email}"></span></p>
                <p><strong>지갑 주소:</strong> <span th:text="${wallet != null ? wallet.address : '-'}"></span></p>
                <p><strong>지갑 잔액:</strong> <span th:text="${wallet != null ? #numbers.formatDecimal(wallet.balance, 0, 'COMMA', 2, 'POINT') : '-'}"></span></p>
                <p><strong>레벨:</strong> <span th:text="${profile.level}"></span></p>
                <p><strong>점수:</strong> <span th:text="${profile.score}"></span></p>
            </div>
        </div>

        <!-- 프로필 수정 폼 -->
        <div class="card mb-4">
            <div class="card-header">프로필 수정</div>
            <div class="card-body">
                <form th:action="@{/user/mypage/updateProfile}" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="nickname" class="form-label">닉네임:</label>
                        <input type="text" class="form-control" id="nickname" name="nickname" th:value="${profile.nickname}" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">이메일:</label>
                        <input type="email" class="form-control" id="email" name="email" th:value="${profile.email}" required>
                    </div>
                    <div class="mb-3">
                        <label for="profileImage" class="form-label">프로필 이미지:</label>
                        <input type="file" class="form-control" id="profileImage" name="profileImage" accept="image/*">
                        <div th:if="${profile.profileImageUrl}">
                            <img th:src="${profile.profileImageUrl}" alt="프로필 이미지" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin-top: 10px;">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="walletAddress" class="form-label">지갑 주소:</label>
                        <input type="text" class="form-control" id="walletAddress" name="walletAddress" th:value="${wallet != null ? wallet.address : ''}">
                    </div>
                    <div class="mb-3">
                        <label for="walletBalance" class="form-label">지갑 잔액:</label>
                        <input type="number" step="0.01" class="form-control" id="walletBalance" name="walletBalance" th:value="${wallet != null ? wallet.balance : 0.00}">
                    </div>
                    <button type="submit" class="btn btn-primary">프로필 업데이트</button>
                </form>
            </div>
        </div>

        <!-- 번들 등록 요청한 목록 -->
        <div class="card mb-4">
            <div class="card-header">내가 등록 요청한 번들</div>
            <div class="card-body">
                <div th:if="${#lists.isEmpty(uploadedBundles)}">
                    <p>등록 요청한 번들이 없습니다.</p>
                </div>
                <div th:each="bundle : ${uploadedBundles}" class="item-card mb-3">
                    <a th:href="@{/api/assetbundles/{id}(id=${bundle.id})}" style="text-decoration: none; color: inherit; display: block; height: 100%;">
                        <div class="item-header">
                            <h3 th:text="${bundle.bundleTitle}">번들 제목</h3>
                            <span class="status" th:classappend="${bundle.status.name().toLowerCase()}" th:text="${bundle.status.displayName}">상태</span>
                        </div>
                        <p class="author">by <span th:text="${bundle.author?.profile?.nickname != null ? bundle.author.profile.nickname : '-'}">사용자 닉네임</span></p>
                        <span class="category" th:classappend="${bundle.category != null ? bundle.category.name().toLowerCase() : '-'}" th:text="${bundle.category != null ? bundle.category.displayName : '-'}">카테고리</span>
                        <p class="desc" th:text="${bundle.bundleDescription}">번들 설명</p>
                        <div class="item-footer">
                            <span th:text="${bundle.views} + ' views'">조회수</span>
                            <span>·</span>
                            <span th:text="${#temporals.format(bundle.createdAt, 'yyyy-MM-dd')}">생성일</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- 펀딩한 번들 목록 -->
        <div class="card mb-4">
            <div class="card-header">내가 펀딩한 번들</div>
            <div class="card-body">
                <div th:if="${#lists.isEmpty(fundedBundles)}">
                    <p>펀딩한 번들이 없습니다.</p>
                </div>
                <div th:each="bundle : ${fundedBundles}" class="item-card mb-3">
                    <a th:href="@{/api/assetbundles/{id}(id=${bundle.id})}" style="text-decoration: none; color: inherit; display: block; height: 100%;">
                        <div class="item-header">
                            <h3 th:text="${bundle.bundleTitle}">번들 제목</h3>
                            <span class="status" th:classappend="${bundle.status.name().toLowerCase()}" th:text="${bundle.status.displayName}">상태</span>
                        </div>
                        <p class="author">by <span th:text="${bundle.author?.profile?.nickname != null ? bundle.author.profile.nickname : '-'}">사용자 닉네임</span></p>
                        <span class="category" th:classappend="${bundle.category != null ? bundle.category.name().toLowerCase() : '-'}" th:text="${bundle.category != null ? bundle.category.displayName : '-'}">카테고리</span>
                        <p class="desc" th:text="${bundle.bundleDescription}">번들 설명</p>
                        <div class="item-footer">
                            <span th:text="${bundle.views} + ' views'">조회수</span>
                            <span>·</span>
                            <span th:text="${#temporals.format(bundle.createdAt, 'yyyy-MM-dd')}">생성일</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
