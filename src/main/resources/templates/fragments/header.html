<div th:fragment="commonHeader" xmlns:th="http://www.thymeleaf.org"
     xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <header class="vsp-header">
        <div class="vsp-header-left">
            <a th:href="@{/home}" class="vsp-logo">VSP</a>
            <nav class="vsp-nav">
                <ul>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/api/assetbundles/bundleList}">창업아이템</a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/api/assetbundles/uploadForm}">번들 등록</a>
                    </li>
                    <li sec:authorize="hasRole('ROLE_ADMIN')">
                        <a th:href="@{/api/assetbundles/admin/bundleList}">Bundle서버 관리</a>
                    </li>
                    <li sec:authorize="hasRole('ROLE_ADMIN')">
                        <a th:href="@{/admin/pendingBundles}">번들 승인 대기</a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="vsp-header-center">
            <input type="text" class="search-input" placeholder="아이템 이름과 등록자 이름으로 검색하세요." />
        </div>
        <div class="vsp-header-right">
            <a th:href="@{/login}" sec:authorize="isAnonymous()" class="login-button">로그인</a>
            <div sec:authorize="isAuthenticated()" class="user-dropdown">
                <div class="user-avatar" onclick="toggleDropdown()">
                    <!-- 프로필 이미지, 없으면 기본이미지 -->
                    <img id="profileImg" th:src="@{/images/man_profile.png}" alt="profile" />
                </div>
                <div id="userDropdownMenu" class="dropdown-menu" style="display: none;">
                    <div class="dropdown-header">
                        <span class="user-name" sec:authentication="name"></span>
                        <span class="welcome-text">WELCOME</span>
                    </div>
                    <a th:href="@{/dashboard}" class="mypage-button dropdown-btn">마이페이지</a>
<!--                    <a th:href="@{/dashboard(fragment='user/likedBundles')}" class="dropdown-btn">-->
<!--                        찜한 아이템 <span class="heart">&#9829;</span>-->
<!--                    </a>-->
                    <a th:href="@{/logout}" class="dropdown-btn logout">로그아웃</a>
                </div>
            </div>
        </div>
    </header>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var isAdmin = /*[[${isAdmin}]]*/ false;
            var profileImg = document.getElementById('profileImg');
            if (profileImg) {
                if (isAdmin) {
                    profileImg.src = '/img/admin_profile.png';
                } else {
                    var imgs = ['/img/man_profile.png', '/img/woman_profile.png'];
                    profileImg.src = imgs[Math.floor(Math.random() * imgs.length)];
                }
            }
        });

        function toggleDropdown() {
            var menu = document.getElementById('userDropdownMenu');
            menu.style.display = (menu.style.display === 'none' || menu.style.display === '') ? 'block' : 'none';
        }
        // 바깥 클릭 시 드롭다운 닫기
        document.addEventListener('click', function(event) {
            var dropdown = document.getElementById('userDropdownMenu');
            var avatar = document.querySelector('.user-avatar');
            if (!dropdown.contains(event.target) && !avatar.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
    </script>
</div>
