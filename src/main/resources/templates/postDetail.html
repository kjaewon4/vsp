<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{fragments/head :: commonHead}">
</head>
<link rel="stylesheet" th:href="@{/css/postDetail.css}">
<body style="padding-top: 72px;">
<header th:replace="fragments/header :: commonHeader"></header>

<main class="detail-container">
    <!-- 네비게이션: 번들 > 번들타이틀 버튼 -->
    <div class="breadcrumb-wrap">
        <a href="/home" class="breadcrumb-link">번들</a>
        <span class="breadcrumb-sep">&gt;</span>
        <a th:href="@{/api/assetbundles/{bundleId}(bundleId=${bundleId})}" class="breadcrumb-link" th:text="${bundleTitle}">번들타이틀</a>
        <span class="breadcrumb-sep">&gt;</span>
        <span class="breadcrumb-current" th:text="${post.title}">게시글 제목</span>
<!--        <a th:href="@{/api/assetbundles/{bundleId}(bundleId=${bundleId})}" class="btn-detail">번들 상세로</a>-->
    </div>

    <!-- 게시글 이름(제목) -->
    <h1 class="post-title" th:text="${post.title}">게시글 제목</h1>

    <!-- 날짜/수정일/작성자: 좌우 정렬 -->
    <div class="post-meta-row">
        <div class="post-meta-left">
            <span class="meta-label">작성일:</span>
            <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-07-23 14:20</span>
            <span th:if="${post.updatedAt != null and post.updatedAt != post.createdAt}" class="meta-sep">|</span>
            <span th:if="${post.updatedAt != null and post.updatedAt != post.createdAt}">
                    <span class="meta-label">수정일:</span>
                    <span th:text="${#temporals.format(post.updatedAt, 'yyyy-MM-dd HH:mm')}"></span>
                </span>
        </div>
        <div class="post-meta-right">
            <span>by <strong th:text="${post.author.username}">작성자</strong></span>
        </div>
    </div>

    <!-- 게시글 내용 -->
    <div class="post-content" th:text="${post.content}">
        게시글 내용이 들어갑니다.
    </div>

    <div th:if="${currentUser != null and (currentUser.userId == post.author.userId or currentUser.profile.isAdmin)}" class="post-actions">
        <a th:href="@{/posts/{postId}/edit(postId=${post.postId})}" class="btn-edit">수정</a>
        <form th:action="@{/posts/{postId}/delete(postId=${post.postId})}" method="post" onsubmit="return confirm('정말로 이 게시글을 삭제하시겠습니까?');" style="display:inline;">
            <button type="submit" class="btn-delete">삭제</button>
        </form>
    </div>

    <!-- 댓글 작성 -->
    <section class="comment-section">
        <h3>댓글 작성</h3>
        <form th:action="@{/comments/posts/{postId}(postId=${post.postId})}" method="post" class="comment-form">
            <textarea name="content" rows="3" placeholder="댓글을 입력하세요" required></textarea>
            <button type="submit" class="btn-comment">댓글 달기</button>
        </form>

        <!-- 댓글 리스트 -->
        <div class="comment-list">
            <div th:each="comment : ${comments}" class="comment-item">
                <div class="comment-meta">
                    <span class="comment-author" th:text="${comment.author.username}">댓글작성자</span>
                    <span class="comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                    <span th:if="${comment.updatedAt != null and comment.updatedAt != comment.createdAt}" class="comment-updated" th:text="'(수정됨: ' + ${#temporals.format(comment.updatedAt, 'yyyy-MM-dd HH:mm')} + ')'"></span>
                </div>
                <div class="comment-content" th:text="${comment.content}"></div>
                <div th:if="${currentUser != null and (currentUser.userId == comment.author.userId or currentUser.profile.isAdmin)}" class="comment-actions">
                    <form th:action="@{/comments/{commentId}/delete(commentId=${comment.commentId})}" method="post" onsubmit="return confirm('정말로 이 댓글을 삭제하시겠습니까?');">
                        <button type="submit" class="btn-comment-delete">삭제</button>
                    </form>
                </div>
            </div>
            <div th:if="${comments.isEmpty()}" class="no-comments">
                아직 댓글이 없습니다.
            </div>
        </div>
    </section>
</main>
</body>
</html>
