<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="fragments/head :: head"></head>
<body>
    <header th:replace="fragments/header :: header"></header>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 th:text="${post.assetBundle.bundleTitle}">게시글 제목</h2>
                        <small>작성자: <span th:text="${post.author.username}"></span></small>
                        <small>작성일: <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span></small>
                    </div>
                    <div class="card-body">
                        <p th:text="${post.content}"></p>
                        <div th:if="${currentUser != null and (currentUser.userId == post.author.userId or currentUser.profile.isAdmin)}">
                            <form th:action="@{/posts/{postId}/delete(postId=${post.postId})}" method="post" style="display:inline;" onsubmit="return confirm('정말로 이 게시글을 삭제하시겠습니까?');">
                                <input type="hidden" th:name="${parameterName}" th:value="${token}" />
                                <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 댓글 섹션 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3>댓글</h3>
                    </div>
                    <div class="card-body">
                        <div th:each="comment : ${comments}" class="mb-3 p-2 border rounded">
                            <p class="mb-1"><strong><span th:text="${comment.author.username}"></span></strong>: <span th:text="${comment.content}"></span></p>
                            <small class="text-muted"><span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span></small>
                            <div th:if="${currentUser != null and (currentUser.userId == comment.author.userId or currentUser.profile.isAdmin)}">
                                <form th:action="@{/comments/{commentId}/delete(commentId=${comment.commentId})}" method="post" style="display:inline;" onsubmit="return confirm('정말로 이 댓글을 삭제하시겠습니까?');">
                                    <input type="hidden" th:name="${parameterName}" th:value="${token}" />
                                    <button type="submit" class="btn btn-danger btn-sm float-end">삭제</button>
                                </form>
                            </div>
                        </div>
                        <div th:if="${comments.isEmpty()}">
                            <p>아직 댓글이 없습니다.</p>
                        </div>

                        <!-- 댓글 작성 폼 -->
                        <h4 class="mt-4">댓글 작성</h4>
                        <form th:action="@{/comments/posts/{postId}(postId=${post.postId})}" method="post">
                            <input type="hidden" th:name="${parameterName}" th:value="${token}" />
                            <div class="form-group">
                                <textarea class="form-control" name="content" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary mt-3">댓글 달기</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
